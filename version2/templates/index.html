{% extends "base.html" %}

{% block title %}Contacts CRM{% endblock %}

{% block content %}
<div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-indigo-400">Contacts CRM</h1>
    <div class="text-gray-300">
        Hello, {{ username }} | 
        <a href="{{ url_for('categories') }}" class="text-blue-400 hover:text-blue-300 ml-2">Categories</a> |
        <a href="{{ url_for('export_contacts') }}" class="text-green-400 hover:text-green-300 ml-2">Export</a> |
        <a href="{{ url_for('logout') }}" class="text-red-400 hover:text-red-300 ml-2">Logout</a>
    </div>
</div>

<form method="get" class="mb-6 flex flex-wrap gap-4 items-end">
    <div class="flex-grow">
        <label class="block mb-1">Search contacts</label>
        <input type="text" name="search" value="{{ search }}" placeholder="Search by name, phone, email or notes"
            class="w-full p-3 rounded bg-gray-800 border border-gray-700">
    </div>
    
    <div>
        <label class="block mb-1">Filter by category</label>
        <select name="category" class="p-3 rounded bg-gray-800 border border-gray-700">
            <option value="">All Categories</option>
            {% for cat in categories %}
                <option value="{{ cat.name }}" {% if category_filter == cat.name %}selected{% endif %}>{{ cat.name }}</option>
            {% endfor %}
        </select>
    </div>
    
    <button class="p-3 bg-indigo-600 hover:bg-indigo-500 rounded">Apply Filters</button>
</form>

<div class="mb-6 p-4 bg-gray-800 rounded-lg shadow-md">
    <h2 class="text-xl font-semibold mb-4">Add Contact</h2>
    <form method="post" action="{{ url_for('add') }}" class="grid gap-3 md:grid-cols-2 lg:grid-cols-3">
        <input name="name" placeholder="Name *" required class="p-3 rounded bg-gray-700 border border-gray-600">
        <input name="phone" placeholder="Phone" class="p-3 rounded bg-gray-700 border border-gray-600">
        <input name="email" placeholder="Email" type="email" class="p-3 rounded bg-gray-700 border border-gray-600">
        <input name="address" placeholder="Address" class="p-3 rounded bg-gray-700 border border-gray-600">
        
        <select name="category" class="p-3 rounded bg-gray-700 border border-gray-600">
            {% for cat in categories %}
                <option value="{{ cat.name }}" {% if cat.name == 'General' %}selected{% endif %}>{{ cat.name }}</option>
            {% endfor %}
        </select>
        
        <input name="notes" placeholder="Notes" class="p-3 rounded bg-gray-700 border border-gray-600">
        
        <button class="col-span-full bg-indigo-600 hover:bg-indigo-500 p-3 rounded">Add Contact</button>
    </form>
</div>

<h2 class="text-xl font-semibold mb-4">Contacts ({{ contacts|length }})</h2>

{% if contacts %}
<div class="overflow-x-auto">
    <table class="min-w-full bg-gray-800 rounded-lg shadow-md">
        <thead>
            <tr class="bg-gray-700">
                <th class="p-3 text-left">Name</th>
                <th class="p-3 text-left">Phone</th>
                <th class="p-3 text-left">Email</th>
                <th class="p-3 text-left">Address</th>
                <th class="p-3 text-left">Category</th>
                <th class="p-3 text-left">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for c in contacts %}
            <tr class="border-t border-gray-700 hover:bg-gray-750">
                <td class="p-3">{{ c['name'] }}</td>
                <td class="p-3">{{ c['phone'] or '-' }}</td>
                <td class="p-3">{{ c['email'] or '-' }}</td>
                <td class="p-3">{{ c['address'] or '-' }}</td>
                <td class="p-3">
                    <span class="px-2 py-1 rounded-full text-xs" 
                          style="background-color: {{ categories|selectattr('name', 'equalto', c['category'])|map(attribute='color')|first|default('#3B82F6') }}20; 
                                 color: {{ categories|selectattr('name', 'equalto', c['category'])|map(attribute='color')|first|default('#3B82F6') }}">
                        {{ c['category'] }}
                    </span>
                </td>
                <td class="p-3">
                    <a href="{{ url_for('edit', id=c['id']) }}" class="text-indigo-400 hover:text-indigo-300">Edit</a> |
                    <a href="{{ url_for('delete', id=c['id']) }}" class="text-red-400 hover:text-red-300" onclick="return confirm('Delete {{ c['name'] }}?')">Delete</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if total_pages > 1 %}
<div class="mt-6 flex justify-center space-x-2">
    {% if page > 1 %}
        <a href="{{ url_for('index', page=page-1, search=search, category=category_filter) }}" class="pagination-link">Previous</a>
    {% endif %}
    
    {% for p in range(1, total_pages + 1) %}
        {% if p == page %}
            <span class="pagination-current">{{ p }}</span>
        {% else %}
            <a href="{{ url_for('index', page=p, search=search, category=category_filter) }}" class="pagination-link">{{ p }}</a>
        {% endif %}
    {% endfor %}
    
    {% if page < total_pages %}
        <a href="{{ url_for('index', page=page+1, search=search, category=category_filter) }}" class="pagination-link">Next</a>
    {% endif %}
</div>
{% endif %}

{% else %}
<p class="empty-state">No contacts found.</p>
{% endif %}
{% endblock %}
